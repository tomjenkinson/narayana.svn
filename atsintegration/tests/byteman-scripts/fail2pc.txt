########################################################################
#
# byteman script used to ensure that tests can synchronize with various
# actions performed by the recovery code

#########################################################################
# rules to identify progress of the periodic recovery listener thread
#

# if a test has set up a rendezvous under key "PR recovery pass begin" then
# enter the rendezvous before starting the recovery run
RULE Fail 2PC
CLASS  com.arjuna.ats.arjuna.coordinator.BasicAction
METHOD phase2Commit
AT ENTRY
BIND NOTHING
IF readCounter("phase2commit") == 0
	DO debug("Called"),
	incrementCounter("phase2commit");
   	Thread.currentThread().stop()
ENDRULE
