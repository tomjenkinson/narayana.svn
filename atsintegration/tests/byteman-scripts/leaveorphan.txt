########################################################################
#
# byteman script used to ensure that tests can synchronize with various
# actions performed by the recovery code

#########################################################################

RULE Fail resource prepare finishing
CLASS  com.arjuna.ats.jta.distributed.TestResource
METHOD prepare
AT EXIT
BIND NOTHING
IF TRUE
	DO debug("Neutralizing target"),
	Thread.currentThread().stop()
ENDRULE


#########################################################################
RULE Fail phase2abort ;)
CLASS  com.arjuna.ats.arjuna.coordinator.BasicAction
METHOD prepare
AT EXIT
BIND NOTHING
IF TRUE
	DO debug("Target neutralized"), 
	Thread.currentThread().stop()
ENDRULE

#########################################################################
RULE Fail insertRecord
CLASS  com.arjuna.ats.arjuna.coordinator.BasicAction
METHOD insertRecord
AT ENTRY
BIND NOTHING
IF TRUE
	DO debug("Target neutralized"), 
	Thread.currentThread().stop()
ENDRULE

#########################################################################
RULE Fail topLevelPrepare
CLASS  com.arjuna.ats.internal.jta.resources.arjunacore.XAResourceRecord
METHOD topLevelPrepare
AT EXIT
BIND NOTHING
IF TRUE
	DO debug("Target neutralized"), 
	Thread.currentThread().stop()
ENDRULE

#########################################################################
RULE Fail topLevelPrepare
CLASS  com.arjuna.ats.internal.jta.resources.arjunacore.XAResourceRecord
METHOD topLevelOnePhaseCommit
AT EXIT
BIND NOTHING
IF TRUE
	DO debug("Target neutralized"), 
	Thread.currentThread().stop()
ENDRULE

#########################################################################
RULE Fail phase2Commit - die die die
CLASS  com.arjuna.ats.arjuna.coordinator.BasicAction
METHOD phase2Commit
AT ENTRY
BIND NOTHING
IF TRUE
	DO debug("Assassinated"),
	incrementCounter("phase2commit");
   	Thread.currentThread().stop()
ENDRULE